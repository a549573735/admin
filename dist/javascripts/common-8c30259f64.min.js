function getStyle(e,t){return e.currentStyle?e.currentStyle[t]:document.defaultView.getComputedStyle(e,null)[t]}function json2css(e){function t(e){var t=e.indexOf("_");if(!(t>0)){for(var n=[],a=0;a<e.length;a++)n.push(e.charAt(a));for(var a=1;a<n.length-1;a++)n[a].charCodeAt(0)>=65&&n[a].charCodeAt(0)<=90&&(n[a]="-"+n[a].toLowerCase());return n.join("")}if(t<e.length-1)return e=e.split("_").join("-")}var n=[];for(var a in e){var o=a;a=t(a),n.push(a+":"+e[o])}return n.join(";")}function CheckCode(e){this.obj=e.obj,this.codesLen=e.codesLen||4}function Common(e){this.obj=$(e),this.uiInit={$lHtml:jQuery("html"),$lBody:jQuery("body"),$lhead:jQuery("#c-header"),$lMain:jQuery("#c-content"),$lFooter:jQuery("#c-footer"),$lUMessage:jQuery("#u-message"),$lUserBtn:jQuery("#u-btn"),$lDate:jQuery(".input-daterange").add(".js-datepicker"),$lMinModal:jQuery(".v-modal-min"),$lMinBtn:jQuery(".v-min-toggle"),$lNav:jQuery(".c-list"),$appKeyBtn:jQuery("#appkey-btn"),$againSecret:jQuery("#again_secret")},this.regIphone=/^1\d{10}$/i,this.regEmail=/^(\w)+(\.\w+)*@(\w)+((\.\w{2,3}){1,3})$/,this.listDown(),this.contentHeight(),this.userMessage(),this.inputDate(),this.minModal(),this.setNavActive(),this.sendMessage(".suggestion-btn","#tables","#val-suggestion",null,"/api/suggestion/msg",null,".v-modal-min",".v-msg",".park-belongId_s"),this.sendMessage(".interview-btn","#tables","#val-interview","#select-interview","/api/interview/msg",null,".v-modal-min",".v-msg",".park-belongId_iv"),this.sendMessage(".appointment-btn","#tables","#val-appointment",null,"/api/appointment/msg","#date-appointment",".v-modal-min",".v-msg",".park-belongId_ap"),this.sendMessage(".inspect-qualified-btn","#tables","#val-qualified",null,"/api/inspect/qualified/msg",null,".v-modal-min",".v-msg",".park-belongId_it"),this.sendMessage(".inspect-qualified-btn2","#tables",null,null,"/api/inspect/qualified/msg",null,null,null,null),this.getAppkey(),this.againSecret(),this.addParty(),this.setPassword(".model-password-btn"),this.EmptyInput(["#modal-addParty","#modal-addCompany"]),this.uiInit.$lMinBtn.attr("bclick",!1),this.setFormDate()}seajs.use("/lib/bootstrap.min.js"),seajs.use("/lib/bootstrap-datepicker.zh-CN.js");var codes={setNumRange:function(e,t){var n=0;if(!isNaN(e)&&!isNaN(t)){var e=Math.round(e),t=Math.round(t);return n=t-e,Math.floor(Math.random()*(n+1))+e}},getColor:function(){for(var e=Math.floor(256*Math.random()*256*256).toString(16);e.length<6;)e="0"+e;return"#"+e},getChar:function(){var e="abcdefghijklmnopqrstuvwxyz",t=Math.floor(26*Math.random());return e.charAt(t)},getNum:function(){return Math.floor(10*Math.random())},getNumRange:function(e,t){return this.setNumRange(e,t)}},codeRender={renderBG:function(e){codes.getColor()},renderLayout:function(e,t){var n=e.offsetHeight,a=e.offsetWidth;""!=getStyle(e,"borderLeftWidth")&&(n-=2,a-=2);for(var o=Math.floor(a/t),i={width:o+"px",lineHeight:n+"px",float:"left",textAlign:"center"},s=0;s<t;s++){var r=document.createElement("div");r.style.cssText=json2css(i),e.appendChild(r)}},getCodes:function(){var e="";return codes.getNumRange(0,1)?(e=codes.getChar(),codes.getNumRange(0,1)&&(e=e.toUpperCase())):e=codes.getNum(),e},renderCode:function(e){var t=codes.getColor(),n=codes.getNumRange(20,28)+"px",a=codes.getNumRange(-60,60)+"deg",o={color:t,font_size:n,"-webkit-transform":"skew("+a+")","-moz-transform":"skew("+a+")","-ms-transform":"skew("+a+")","-o-transform":"skew("+a+")"};codes.getNumRange(0,1)&&(o.fontWeight="bold"),e.style.cssText+=json2css(o)}};CheckCode.prototype.renderCode=function(){codeRender.renderBG(this.obj),codeRender.renderLayout(this.obj,this.codesLen);for(var e=this.obj.getElementsByTagName("div"),t=0;t<e.length;t++)e[t].innerHTML=codeRender.getCodes(),codeRender.renderCode(e[t])},CheckCode.prototype.render=function(){this.renderCode()},CheckCode.prototype.refresh=function(){this.obj.innerHTML="",this.renderCode()},CheckCode.prototype.getCodes=function(){for(var e="",t=this.obj.getElementsByTagName("div"),n=0;n<t.length;n++)e+=t[n].innerHTML;return e},Common.prototype.listDown=function(e){this.obj.on("click",function(){$(this).next().hasClass("open")?($(this).find("i").attr("class","icon-caret-right"),$(this).next().removeClass("open")):($(this).find("i").attr("class","icon-caret-down"),$(this).next().addClass("open"))})},Common.prototype.contentHeight=function(){var e=jQuery(window).height(),t=this.uiInit.$lhead.outerHeight(),n=this.uiInit.$lFooter.outerHeight(),a=this.uiInit.$lMain.outerHeight();if(a+t+n<e){var o=e-n-t;this.uiInit.$lMain.css({"min-height":o-50,"margin-bottom":"50px"})}this.uiInit.$lMain.css({"margin-bottom":"50px"}),this.uiInit.$lFooter.css("visibility","inherit")},Common.prototype.userMessage=function(){var e=null;this.uiInit.$lUserBtn.hover(function(){var e=this;$.get("/user/verify").then(function(t){console.log(t),$(".sm_dian").html(t.content.messageCount),$(e).next().show()})},function(){var t=this;e=setTimeout(function(){$(t).next().hide()},1500)}),$("#tongzhi").hover(function(){clearTimeout(e),$(this).show()},function(){$(this).hide()})},Common.prototype.inputDate=function(){this.uiInit.$lDate.datepicker({language:"zh-CN",weekStart:1,autoclose:!0,todayHighlight:!0,format:"yyyy-mm-dd"})},Common.prototype.minModal=function(){this.uiInit.$lMinBtn.on("click",function(){var e=this;$(this).parent().siblings(".v-item-btn").children(".v-modal-min").hide(),$(this).parent().siblings(".v-item-btn").children(".v-min-toggle").attr("bclick",!1),$(this).closest(".v-item-btn").find(".v-msg").hide(),$(this).closest(".v-item-btn").find("textarea").val(""),"false"==$(this).attr("bclick")?($(this).next().show().animate({opacity:"1"}),$(e).attr("bclick",!0)):$(this).next().animate({opacity:"0"},function(){$(this).hide(),$(e).attr("bclick",!1)})})},Common.prototype.setNavActive=function(){var e=window.location.pathname,t=(window.location.search,$.query.get("view"));"/user/admin/add"==e?e="/user/edit/list":t?e="/organize/company":"/user/add"==e&&(e="/user/role/list"),this.uiInit.$lNav.find("li a").each(function(t,n){$(n).attr("href").split("?")[0]==e&&($(n).addClass("active"),"LI"!==$(n).parent()[0].tagName&&($(n).parent().parent().prev().find("i").attr("class","icon-caret-down"),$(n).parent().parent().addClass("open")))})},Common.prototype.sendMessage=function(e,t,n,a,o,i,s,r,l){$(e).on("click",function(){var e=$.query.get("id"),c="COMPANY",d=[];$(t).find("input[type=checkbox]:checked").each(function(e,t){d.push($(t).val())});var u=$(t).find("input[type=checkbox]:checked").attr("data-type"),h={suggestion:$(n).val(),target:d.length>0?d:e,type:u?u:c,period:$(a).val(),inspectDate:$(i).val(),notes:$(n).val(),status:$(this).attr("data-status"),ccPark:!!$(l).prop("checked")},m=this;$.post(o,h).then(function(e){e.success?($(m).closest(s).find(r).html("提交成功").show(),$(m).closest(".v-modal-min").hide().prev().attr("bclick","false"),alert("提交成功")):($(m).closest(s).find(r).html(e.errMessage).show(),alert("提交失败"+e.errMessage))})})},Common.prototype.addZero=function(e){return e=e>9?e:"0"+e},Common.prototype.setForm=function(){var e=new Date,t=e.getFullYear()+"-"+this.addZero(e.getMonth())+"-"+this.addZero(e.getDate()),n=e.getFullYear()+"-"+this.addZero(e.getMonth()+1)+"-"+this.addZero(e.getDate());return{from:t,to:n}},Common.prototype.getAppkey=function(){this.uiInit.$appKeyBtn.on("click",function(){$.get("/api/app/company/appKey").then(function(e){$(".appkey").html(e.content.appKey),$(".secret").html(e.content.secret)})})},Common.prototype.againSecret=function(){this.uiInit.$againSecret.on("click",function(){$.get("/api/app/company/secret/generate").then(function(e){$(".secret").html(e.content)})})},Common.prototype.addParty=function(e){var t=this;$(".admin-add-btn").on("click",function(){var e={parentId:"all"==$(".select_park").val()?"":$(".select_park").val(),name:$(".admin-name").val(),phone:$(".admin-phone").val(),contact:$(".admin-contact").val(),address:$(".admin-address").val(),username:$(".admin-username").val(),mail:$(".admin-email").val(),id:$(".admin-id").val(),admin:$(".admin-admin").val()};void 0==e.parentId&&(e.parentId="ROOT");var n=t.checkEmpty($(this).closest(".form_Party").find("input[type=text]")),a=t.checkEmpty($(this).closest(".form_Party").find(".admin-email"));return"false"==n.state?(alert(n.message),!1):"false"==a.state?(alert(a.message),!1):void("modify"==$(".admin-type").val()?$.post("/admin/organize/modify",e).then(function(e){e.success?($(".admin-contact").val(""),$(".admin-phone").val(""),$(".admin-address").val(""),$(".admin-name").val(""),$(".admin-email").val(""),$(".admin-username").val(""),$(".admin-admin").val(""),$(".admin-id").val(""),alert("修改成功")):alert(e.errMessage)}):$.post("/api/organize/add",e).then(function(e){e.success?($(".admin-contact").val(""),$(".admin-phone").val(""),$(".admin-address").val(""),$(".admin-name").val(""),$(".admin-email").val(""),$(".admin-username").val(""),$(".admin-admin").val(""),$(".admin-id").val(""),alert("添加成功")):alert(e.errMessage)}))})},Common.prototype.checkEmpty=function(e){var t=0;return $.each(e,function(e,n){""==$(n).val()&&t++}),0!=t?{message:"输入框不能为空",state:"false"}:{message:"",state:"true"}},Common.prototype.checkEmail=function(e){return this.regEmail.test(e.val())?{message:"",state:"true"}:{message:"您输入的邮箱有误,请重新输入",state:"false"}},Common.prototype.checkIphone=function(e){return this.regIphone.test(e.val())?{message:"",state:"true"}:{message:"您输入的手机有误,请重新输入",state:"false"}},Common.prototype.countdown=function(e){e.attr("disabled","disabled");var t=60,n=null;clearInterval(n),n=setInterval(function(){return t--,t<0?(clearInterval(n),e.removeAttr("disabled").html("重新发送"),e.css({cursor:"pointer"}),!1):(t<10&&(t="0"+t),void e.html(t+"秒"))},1e3)},Common.prototype.setPassword=function(e){$(e).on("click",function(){var e=this,t={newPassword:$("#new-password").val(),oldPassword:$("#old-password").val()};$.post("/put/user/password",t).then(function(t){t.success?($(e).parent().next().show().html("密码修改成功"),setTimeout(function(){$("#modal-password").modal("toggle"),$(e).parent().next().hide()},1500)):$(e).parent().next().show().html(t.errMessage)})})},Common.prototype.getChecked=function(){var e=[],t=$.query.get("name"),n=$.query.get("permissionIds").toString();$(".per_name").val(t),n.indexOf(",")!=-1?e=$.query.get("permissionIds").split(","):e.push(n),""!=e&&e.forEach(function(e){$(".rolt-user-checked").find("input[type=checkbox]").each(function(t,n){$(n).attr("data-id")==e&&$(n).prop("checked","checked")})})},Common.prototype.EmptyInput=function(e){$(".add_admin_userBtn").on("click",function(){for(var t=0;t<e.length;t++)$(e[t]).find("input").val("")})},Common.prototype.setForm=function(){var e=new Date,t=e.getFullYear()+"-"+this.addZero(e.getMonth())+"-"+this.addZero(e.getDate()),n=e.getFullYear()+"-"+this.addZero(e.getMonth()+1)+"-"+this.addZero(e.getDate());return{from:t,to:n}},Common.prototype.setFormDate=function(){$("input[name=from]").attr("placeholder",this.setForm().from),$("input[name=to]").attr("placeholder",this.setForm().to)};var uiHelperTableToolsCheckable=function(){var e=jQuery(".js-table-checkable"),t=jQuery("#v-all-check");jQuery("input:checkbox",t).click(function(){var t=jQuery(this).prop("checked");this.bClick=!this.bClick,this.bClick?jQuery(this).closest("#v-all-check").addClass("active"):jQuery(this).closest("#v-all-check").removeClass("active"),jQuery("tbody input:checkbox",e).each(function(){var e=jQuery(this);e.prop("checked",t),uiHelperTableToolscheckRow(e,t)})}),jQuery("tbody input:checkbox",e).click(function(){var e=jQuery(this);uiHelperTableToolscheckRow(e,e.prop("checked"))}),jQuery("tbody > tr",e).click(function(e){if("checkbox"!==e.target.type&&"button"!==e.target.type&&"a"!==e.target.tagName.toLowerCase()&&!jQuery(e.target).parent("label").length){var t=jQuery("input:checkbox",this),n=t.prop("checked");console.log(!n),t.prop("checked",!n),uiHelperTableToolscheckRow(t,!n)}})},uiHelperTableToolscheckRow=function(e,t){t?e.closest("tr").addClass("active"):e.closest("tr").removeClass("active")};